(function(w,N){typeof exports=="object"&&typeof module<"u"?N(exports,require("@reduxjs/toolkit")):typeof define=="function"&&define.amd?define(["exports","@reduxjs/toolkit"],N):(w=typeof globalThis<"u"?globalThis:w||self,N(w.Trrack={},w.RTK))})(this,function(w,N){"use strict";function Te(){const e=new Map;return{listen(t,r){return e.has(t)||e.set(t,[]),e.get(t).push(r),()=>{e.set(t,(e.get(t)||[]).filter(n=>n!==r))}},fire(t,r){const n=e.get(t);n&&n.forEach(o=>o(r))}}}let $;const Qe=new Uint8Array(16);function qe(){if(!$&&($=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!$))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return $(Qe)}const O=[];for(let e=0;e<256;++e)O.push((e+256).toString(16).slice(1));function Ye(e,t=0){return(O[e[t+0]]+O[e[t+1]]+O[e[t+2]]+O[e[t+3]]+"-"+O[e[t+4]]+O[e[t+5]]+"-"+O[e[t+6]]+O[e[t+7]]+"-"+O[e[t+8]]+O[e[t+9]]+"-"+O[e[t+10]]+O[e[t+11]]+O[e[t+12]]+O[e[t+13]]+O[e[t+14]]+O[e[t+15]]).toLowerCase()}const Ne={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Se(e,t,r){if(Ne.randomUUID&&!t&&!e)return Ne.randomUUID();e=e||{};const n=e.random||(e.rng||qe)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(let o=0;o<16;++o)t[r+o]=n[o];return t}return Ye(n)}class S{static get(){let t=Se();for(;this.ids.has(t);)t=Se();return this.ids.set(t,!0),t}}S.ids=new Map;function T(e){return"parent"in e}function Xe(e){return!T(e)}function De(e){const{label:t=void 0,state:r,initialArtifact:n,initialMetadata:o}=e,a={annotation:[],bookmark:[]},u=Object.keys(o||{}).reduce((f,c)=>(f[c]=[],o&&o[c]&&f[c].push({type:c,id:S.get(),val:o[c],createdOn:Date.now()}),f),a),l=n?[{id:S.get(),createdOn:Date.now(),val:n}]:[];return{id:S.get(),label:t||"Root",event:"Root",children:[],level:0,createdOn:Date.now(),meta:u,artifacts:l,state:{type:"checkpoint",val:r}}}function Re({parent:e,state:t,label:r,sideEffects:n={do:[],undo:[]},initialMetadata:o,initialArtifact:a,event:u}){const l={annotation:[],bookmark:[]},f=Object.keys(o||{}).reduce((i,s)=>(i[s]=[],o&&o[s]&&i[s].push({type:s,id:S.get(),val:o[s],createdOn:Date.now()}),i),l),c=a?[{id:S.get(),createdOn:Date.now(),val:a}]:[];return{id:S.get(),label:r,event:u,children:[],parent:e.id,createdOn:Date.now(),meta:f,artifacts:c,sideEffects:n,state:t,level:e.level+1}}function y(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if({}.NODE_ENV!=="production"){var o=it[e],a=o?typeof o=="function"?o.apply(null,r):o:"unknown error nr: "+e;throw Error("[Immer] "+a)}throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(u){return"'"+u+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function L(e){return!!e&&!!e[b]}function R(e){var t;return!!e&&(function(r){if(!r||typeof r!="object")return!1;var n=Object.getPrototypeOf(r);if(n===null)return!0;var o=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;return o===Object||typeof o=="function"&&Function.toString.call(o)===ut}(e)||Array.isArray(e)||!!e[K]||!!(!((t=e.constructor)===null||t===void 0)&&t[K])||G(e)||Q(e))}function F(e,t,r){r===void 0&&(r=!1),I(e)===0?(r?Object.keys:he)(e).forEach(function(n){r&&typeof n=="symbol"||t(n,e[n],e)}):e.forEach(function(n,o){return t(o,n,e)})}function I(e){var t=e[b];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:G(e)?2:Q(e)?3:0}function k(e,t){return I(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function W(e,t){return I(e)===2?e.get(t):e[t]}function Ie(e,t,r){var n=I(e);n===2?e.set(t,r):n===3?(e.delete(t),e.add(r)):e[t]=r}function Ze(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function G(e){return ot&&e instanceof Map}function Q(e){return at&&e instanceof Set}function j(e){return e.o||e.t}function re(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=ct(e);delete t[b];for(var r=he(t),n=0;n<r.length;n++){var o=r[n],a=t[o];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[o]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[o]})}return Object.create(Object.getPrototypeOf(e),t)}function ne(e,t){return t===void 0&&(t=!1),oe(e)||L(e)||!R(e)||(I(e)>1&&(e.set=e.add=e.clear=e.delete=Ve),Object.freeze(e),t&&F(e,function(r,n){return ne(n,!0)},!0)),e}function Ve(){y(2)}function oe(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function D(e){var t=ve[e];return t||y(18,e),t}function et(e,t){ve[e]||(ve[e]=t)}function Le(){return{}.NODE_ENV==="production"||z||y(0),z}function ae(e,t){t&&(D("Patches"),e.u=[],e.s=[],e.v=t)}function q(e){ie(e),e.p.forEach(tt),e.p=null}function ie(e){e===z&&(z=e.l)}function je(e){return z={p:[],l:z,h:e,m:!0,_:0}}function tt(e){var t=e[b];t.i===0||t.i===1?t.j():t.O=!0}function ue(e,t){t._=t.p.length;var r=t.p[0],n=e!==void 0&&e!==r;return t.h.g||D("ES5").S(t,e,n),n?(r[b].P&&(q(t),y(4)),R(e)&&(e=Y(t,e),t.l||X(t,e)),t.u&&D("Patches").M(r[b].t,e,t.u,t.s)):e=Y(t,r,[]),q(t),t.u&&t.v(t.u,t.s),e!==pe?e:void 0}function Y(e,t,r){if(oe(t))return t;var n=t[b];if(!n)return F(t,function(a,u){return Me(e,n,t,a,u,r)},!0),t;if(n.A!==e)return t;if(!n.P)return X(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var o=n.i===4||n.i===5?n.o=re(n.k):n.o;F(n.i===3?new Set(o):o,function(a,u){return Me(e,n,o,a,u,r)}),X(e,o,!1),r&&e.u&&D("Patches").R(n,r,e.u,e.s)}return n.o}function Me(e,t,r,n,o,a){if({}.NODE_ENV!=="production"&&o===r&&y(5),L(o)){var u=Y(e,o,a&&t&&t.i!==3&&!k(t.D,n)?a.concat(n):void 0);if(Ie(r,n,u),!L(u))return;e.m=!1}if(R(o)&&!oe(o)){if(!e.h.F&&e._<1)return;Y(e,o),t&&t.A.l||X(e,o)}}function X(e,t,r){r===void 0&&(r=!1),e.h.F&&e.m&&ne(t,r)}function ce(e,t){var r=e[b];return(r?j(r):e)[t]}function Ue(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function se(e){e.P||(e.P=!0,e.l&&se(e.l))}function fe(e){e.o||(e.o=re(e.t))}function le(e,t,r){var n=G(t)?D("MapSet").N(t,r):Q(t)?D("MapSet").T(t,r):e.g?function(o,a){var u=Array.isArray(o),l={i:u?1:0,A:a?a.A:Le(),P:!1,I:!1,D:{},l:a,t:o,k:null,o:null,j:null,C:!1},f=l,c=ye;u&&(f=[l],c=H);var i=Proxy.revocable(f,c),s=i.revoke,h=i.proxy;return l.k=h,l.j=s,h}(t,r):D("ES5").J(t,r);return(r?r.A:Le()).p.push(n),n}function rt(e){return L(e)||y(22,e),function t(r){if(!R(r))return r;var n,o=r[b],a=I(r);if(o){if(!o.P&&(o.i<4||!D("ES5").K(o)))return o.t;o.I=!0,n=Ce(r,a),o.I=!1}else n=Ce(r,a);return F(n,function(u,l){o&&W(o.t,u)===l||Ie(n,u,t(l))}),a===3?new Set(n):n}(e)}function Ce(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return re(e)}function nt(){function e(n){if(!R(n))return n;if(Array.isArray(n))return n.map(e);if(G(n))return new Map(Array.from(n.entries()).map(function(u){return[u[0],e(u[1])]}));if(Q(n))return new Set(Array.from(n).map(e));var o=Object.create(Object.getPrototypeOf(n));for(var a in n)o[a]=e(n[a]);return k(n,K)&&(o[K]=n[K]),o}function t(n){return L(n)?e(n):n}var r="add";et("Patches",{$:function(n,o){return o.forEach(function(a){for(var u=a.path,l=a.op,f=n,c=0;c<u.length-1;c++){var i=I(f),s=""+u[c];i!==0&&i!==1||s!=="__proto__"&&s!=="constructor"||y(24),typeof f=="function"&&s==="prototype"&&y(24),typeof(f=W(f,s))!="object"&&y(15,u.join("/"))}var h=I(f),d=e(a.value),p=u[u.length-1];switch(l){case"replace":switch(h){case 2:return f.set(p,d);case 3:y(16);default:return f[p]=d}case r:switch(h){case 1:return p==="-"?f.push(d):f.splice(p,0,d);case 2:return f.set(p,d);case 3:return f.add(d);default:return f[p]=d}case"remove":switch(h){case 1:return f.splice(p,1);case 2:return f.delete(p);case 3:return f.delete(a.value);default:return delete f[p]}default:y(17,l)}}),n},R:function(n,o,a,u){switch(n.i){case 0:case 4:case 2:return function(l,f,c,i){var s=l.t,h=l.o;F(l.D,function(d,p){var v=W(s,d),m=W(h,d),E=p?k(s,d)?"replace":r:"remove";if(v!==m||E!=="replace"){var A=f.concat(d);c.push(E==="remove"?{op:E,path:A}:{op:E,path:A,value:m}),i.push(E===r?{op:"remove",path:A}:E==="remove"?{op:r,path:A,value:t(v)}:{op:"replace",path:A,value:t(v)})}})}(n,o,a,u);case 5:case 1:return function(l,f,c,i){var s=l.t,h=l.D,d=l.o;if(d.length<s.length){var p=[d,s];s=p[0],d=p[1];var v=[i,c];c=v[0],i=v[1]}for(var m=0;m<s.length;m++)if(h[m]&&d[m]!==s[m]){var E=f.concat([m]);c.push({op:"replace",path:E,value:t(d[m])}),i.push({op:"replace",path:E,value:t(s[m])})}for(var A=s.length;A<d.length;A++){var C=f.concat([A]);c.push({op:r,path:C,value:t(d[A])})}s.length<d.length&&i.push({op:"replace",path:f.concat(["length"]),value:s.length})}(n,o,a,u);case 3:return function(l,f,c,i){var s=l.t,h=l.o,d=0;s.forEach(function(p){if(!h.has(p)){var v=f.concat([d]);c.push({op:"remove",path:v,value:p}),i.unshift({op:r,path:v,value:p})}d++}),d=0,h.forEach(function(p){if(!s.has(p)){var v=f.concat([d]);c.push({op:r,path:v,value:p}),i.unshift({op:"remove",path:v,value:p})}d++})}(n,o,a,u)}},M:function(n,o,a,u){a.push({op:"replace",path:[],value:o===pe?void 0:o}),u.push({op:"replace",path:[],value:n})}})}function It(e){return e}var Fe,z,de=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",ot=typeof Map<"u",at=typeof Set<"u",ze=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",pe=de?Symbol.for("immer-nothing"):((Fe={})["immer-nothing"]=!0,Fe),K=de?Symbol.for("immer-draftable"):"__$immer_draftable",b=de?Symbol.for("immer-state"):"__$immer_state",it={0:"Illegal state",1:"Immer drafts cannot have computed properties",2:"This object has been frozen and should not be mutated",3:function(e){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+e},4:"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.",5:"Immer forbids circular references",6:"The first or second argument to `produce` must be a function",7:"The third argument to `produce` must be a function or undefined",8:"First argument to `createDraft` must be a plain object, an array, or an immerable object",9:"First argument to `finishDraft` must be a draft returned by `createDraft`",10:"The given draft is already finalized",11:"Object.defineProperty() cannot be used on an Immer draft",12:"Object.setPrototypeOf() cannot be used on an Immer draft",13:"Immer only supports deleting array indices",14:"Immer only supports setting array indices and the 'length' property",15:function(e){return"Cannot apply patch, path doesn't resolve: "+e},16:'Sets cannot have "replace" patches.',17:function(e){return"Unsupported patch operation: "+e},18:function(e){return"The plugin for '"+e+"' has not been loaded into Immer. To enable the plugin, import and call `enable"+e+"()` when initializing your application."},20:"Cannot use proxies if Proxy, Proxy.revocable or Reflect are not available",21:function(e){return"produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '"+e+"'"},22:function(e){return"'current' expects a draft, got: "+e},23:function(e){return"'original' expects a draft, got: "+e},24:"Patching reserved attributes like __proto__, prototype and constructor is not allowed"},ut=""+Object.prototype.constructor,he=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,ct=Object.getOwnPropertyDescriptors||function(e){var t={};return he(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},ve={},ye={get:function(e,t){if(t===b)return e;var r=j(e);if(!k(r,t))return function(o,a,u){var l,f=Ue(a,u);return f?"value"in f?f.value:(l=f.get)===null||l===void 0?void 0:l.call(o.k):void 0}(e,r,t);var n=r[t];return e.I||!R(n)?n:n===ce(e.t,t)?(fe(e),e.o[t]=le(e.A.h,n,e)):n},has:function(e,t){return t in j(e)},ownKeys:function(e){return Reflect.ownKeys(j(e))},set:function(e,t,r){var n=Ue(j(e),t);if(n?.set)return n.set.call(e.k,r),!0;if(!e.P){var o=ce(j(e),t),a=o?.[b];if(a&&a.t===r)return e.o[t]=r,e.D[t]=!1,!0;if(Ze(r,o)&&(r!==void 0||k(e.t,t)))return!0;fe(e),se(e)}return e.o[t]===r&&typeof r!="number"&&(r!==void 0||t in e.o)||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return ce(e.t,t)!==void 0||t in e.t?(e.D[t]=!1,fe(e),se(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=j(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty:function(){y(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){y(12)}},H={};F(ye,function(e,t){H[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),H.deleteProperty=function(e,t){return{}.NODE_ENV!=="production"&&isNaN(parseInt(t))&&y(13),H.set.call(this,e,t,void 0)},H.set=function(e,t,r){return{}.NODE_ENV!=="production"&&t!=="length"&&isNaN(parseInt(t))&&y(14),ye.set.call(this,e[0],t,r,e[0])};var st=function(){function e(r){var n=this;this.g=ze,this.F=!0,this.produce=function(o,a,u){if(typeof o=="function"&&typeof a!="function"){var l=a;a=o;var f=n;return function(v){var m=this;v===void 0&&(v=l);for(var E=arguments.length,A=Array(E>1?E-1:0),C=1;C<E;C++)A[C-1]=arguments[C];return f.produce(v,function(Pe){var Ge;return(Ge=a).call.apply(Ge,[m,Pe].concat(A))})}}var c;if(typeof a!="function"&&y(6),u!==void 0&&typeof u!="function"&&y(7),R(o)){var i=je(n),s=le(n,o,void 0),h=!0;try{c=a(s),h=!1}finally{h?q(i):ie(i)}return typeof Promise<"u"&&c instanceof Promise?c.then(function(v){return ae(i,u),ue(v,i)},function(v){throw q(i),v}):(ae(i,u),ue(c,i))}if(!o||typeof o!="object"){if((c=a(o))===void 0&&(c=o),c===pe&&(c=void 0),n.F&&ne(c,!0),u){var d=[],p=[];D("Patches").M(o,c,d,p),u(d,p)}return c}y(21,o)},this.produceWithPatches=function(o,a){if(typeof o=="function")return function(c){for(var i=arguments.length,s=Array(i>1?i-1:0),h=1;h<i;h++)s[h-1]=arguments[h];return n.produceWithPatches(c,function(d){return o.apply(void 0,[d].concat(s))})};var u,l,f=n.produce(o,a,function(c,i){u=c,l=i});return typeof Promise<"u"&&f instanceof Promise?f.then(function(c){return[c,u,l]}):[f,u,l]},typeof r?.useProxies=="boolean"&&this.setUseProxies(r.useProxies),typeof r?.autoFreeze=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){R(r)||y(8),L(r)&&(r=rt(r));var n=je(this),o=le(this,r,void 0);return o[b].C=!0,ie(n),o},t.finishDraft=function(r,n){var o=r&&r[b];({}).NODE_ENV!=="production"&&(o&&o.C||y(9),o.I&&y(10));var a=o.A;return ae(a,n),ue(void 0,a)},t.setAutoFreeze=function(r){this.F=r},t.setUseProxies=function(r){r&&!ze&&y(20),this.g=r},t.applyPatches=function(r,n){var o;for(o=n.length-1;o>=0;o--){var a=n[o];if(a.path.length===0&&a.op==="replace"){r=a.value;break}}o>-1&&(n=n.slice(o+1));var u=D("Patches").$;return L(r)?u(r,n):this.produce(r,function(l){return u(l,n)})},e}(),P=new st,ft=P.produce;P.produceWithPatches.bind(P),P.setAutoFreeze.bind(P),P.setUseProxies.bind(P),P.applyPatches.bind(P),P.createDraft.bind(P),P.finishDraft.bind(P);function lt(e,t={}){const{artifact:r=void 0,metadata:n=void 0,rootLabel:o="Root"}=t,a=De({state:e,label:o,initialArtifact:r,initialMetadata:n}),u={nodes:{[a.id]:a},root:a.id,current:a.id};return N.createSlice({name:"provenance-graph",initialState:u,reducers:{addMetadata(f,c){const{id:i,meta:s}=c.payload,h=f.nodes[i].meta,d=Object.keys(s).reduce((p,v)=>(p[v]||(p[v]=[]),p[v].push({type:v,id:S.get(),val:s[v],createdOn:Date.now()}),p),h);f.nodes[c.payload.id].meta=d},addArtifact(f,c){f.nodes[c.payload.id].artifacts.push({id:S.get(),createdOn:Date.now(),val:c.payload.artifact})},changeCurrent(f,c){f.current=c.payload},addNode(f,{payload:c}){f.nodes[c.id]=c,f.nodes[c.parent].children.push(c.id),f.current=c.id},load(f,{payload:c}){return c}}})}function xe(e){const t=new Map,{reducer:r,actions:n,getInitialState:o}=lt(e),a=N.createListenerMiddleware();a.startListening({matcher:N.isAnyOf(n.changeCurrent,n.addNode),effect:(l,f)=>{f.cancelActiveListeners(),t.forEach(c=>{const i=N.isAnyOf(n.addNode)(l),{skipOnNew:s}=c.config;s&&i||c.func(i?"new":"traversal")})}});const u=N.configureStore({reducer:r,middleware:l=>l().prepend(a.middleware)});return{initialState:o(),get backend(){return u.getState()},get current(){return u.getState().nodes[u.getState().current]},get root(){return u.getState().nodes[u.getState().root]},currentChange(l,f){const c={id:S.get(),func:l,config:f};return t.set(c.id,c),()=>t.delete(c.id)},update:u.dispatch,...n}}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var dt=globalThis&&globalThis.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var a in o)o.hasOwnProperty(a)&&(n[a]=o[a])},e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),pt=Object.prototype.hasOwnProperty;function ge(e,t){return pt.call(e,t)}function me(e){if(Array.isArray(e)){for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(e);var n=[];for(var o in e)ge(e,o)&&n.push(o);return n}function _(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function we(e){for(var t=0,r=e.length,n;t<r;){if(n=e.charCodeAt(t),n>=48&&n<=57){t++;continue}return!1}return!0}function M(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Je(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Oe(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,r=e.length;t<r;t++)if(Oe(e[t]))return!0}else if(typeof e=="object"){for(var n=me(e),o=n.length,a=0;a<o;a++)if(Oe(e[n[a]]))return!0}}return!1}function ke(e,t){var r=[e];for(var n in t){var o=typeof t[n]=="object"?JSON.stringify(t[n],null,2):t[n];typeof o<"u"&&r.push(n+": "+o)}return r.join(`
`)}var Ke=function(e){dt(t,e);function t(r,n,o,a,u){var l=this.constructor,f=e.call(this,ke(r,{name:n,index:o,operation:a,tree:u}))||this;return f.name=n,f.index=o,f.operation=a,f.tree=u,Object.setPrototypeOf(f,l.prototype),f.message=ke(r,{name:n,index:o,operation:a,tree:u}),f}return t}(Error),g=Ke,ht=_,x={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var n=e[t];return delete e[t],{newDocument:r,removed:n}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:function(e,t,r){var n=Z(r,this.path);n&&(n=_(n));var o=U(r,{op:"remove",path:this.from}).removed;return U(r,{op:"add",path:this.path,value:o}),{newDocument:r,removed:n}},copy:function(e,t,r){var n=Z(r,this.from);return U(r,{op:"add",path:this.path,value:_(n)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:B(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}},vt={add:function(e,t,r){return we(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){var n=e.splice(t,1);return{newDocument:r,removed:n[0]}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:x.move,copy:x.copy,test:x.test,_get:x._get};function Z(e,t){if(t=="")return e;var r={op:"_get",path:t};return U(e,r),r.value}function U(e,t,r,n,o,a){if(r===void 0&&(r=!1),n===void 0&&(n=!0),o===void 0&&(o=!0),a===void 0&&(a=0),r&&(typeof r=="function"?r(t,0,e,t.path):ee(t,0)),t.path===""){var u={newDocument:e};if(t.op==="add")return u.newDocument=t.value,u;if(t.op==="replace")return u.newDocument=t.value,u.removed=e,u;if(t.op==="move"||t.op==="copy")return u.newDocument=Z(e,t.from),t.op==="move"&&(u.removed=e),u;if(t.op==="test"){if(u.test=B(e,t.value),u.test===!1)throw new g("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return u.newDocument=e,u}else{if(t.op==="remove")return u.removed=e,u.newDocument=null,u;if(t.op==="_get")return t.value=e,u;if(r)throw new g("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return u}}else{n||(e=_(e));var l=t.path||"",f=l.split("/"),c=e,i=1,s=f.length,h=void 0,d=void 0,p=void 0;for(typeof r=="function"?p=r:p=ee;;){if(d=f[i],d&&d.indexOf("~")!=-1&&(d=Je(d)),o&&(d=="__proto__"||d=="prototype"&&i>0&&f[i-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&h===void 0&&(c[d]===void 0?h=f.slice(0,i).join("/"):i==s-1&&(h=t.path),h!==void 0&&p(t,0,e,h)),i++,Array.isArray(c)){if(d==="-")d=c.length;else{if(r&&!we(d))throw new g("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);we(d)&&(d=~~d)}if(i>=s){if(r&&t.op==="add"&&d>c.length)throw new g("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);var u=vt[t.op].call(t,c,d,e);if(u.test===!1)throw new g("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return u}}else if(i>=s){var u=x[t.op].call(t,c,d,e);if(u.test===!1)throw new g("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return u}if(c=c[d],r&&i<s&&(!c||typeof c!="object"))throw new g("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,t,e)}}}function V(e,t,r,n,o){if(n===void 0&&(n=!0),o===void 0&&(o=!0),r&&!Array.isArray(t))throw new g("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(e=_(e));for(var a=new Array(t.length),u=0,l=t.length;u<l;u++)a[u]=U(e,t[u],r,!0,o,u),e=a[u].newDocument;return a.newDocument=e,a}function yt(e,t,r){var n=U(e,t);if(n.test===!1)throw new g("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return n.newDocument}function ee(e,t,r,n){if(typeof e!="object"||e===null||Array.isArray(e))throw new g("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(x[e.op]){if(typeof e.path!="string")throw new g("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new g('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new g("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new g("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Oe(e.value))throw new g("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);if(r){if(e.op=="add"){var o=e.path.split("/").length,a=n.split("/").length;if(o!==a+1&&o!==a)throw new g("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==n)throw new g("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if(e.op==="move"||e.op==="copy"){var u={op:"_get",path:e.from,value:void 0},l=He([u],r);if(l&&l.name==="OPERATION_PATH_UNRESOLVABLE")throw new g("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new g("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function He(e,t,r){try{if(!Array.isArray(e))throw new g("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)V(_(t),_(e),r||!0);else{r=r||ee;for(var n=0;n<e.length;n++)r(e[n],n,t,void 0)}}catch(o){if(o instanceof g)return o;throw o}}function B(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=Array.isArray(e),n=Array.isArray(t),o,a,u;if(r&&n){if(a=e.length,a!=t.length)return!1;for(o=a;o--!==0;)if(!B(e[o],t[o]))return!1;return!0}if(r!=n)return!1;var l=Object.keys(e);if(a=l.length,a!==Object.keys(t).length)return!1;for(o=a;o--!==0;)if(!t.hasOwnProperty(l[o]))return!1;for(o=a;o--!==0;)if(u=l[o],!B(e[u],t[u]))return!1;return!0}return e!==e&&t!==t}const gt=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:g,_areEquals:B,applyOperation:U,applyPatch:V,applyReducer:yt,deepClone:ht,getValueByPointer:Z,validate:He,validator:ee},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Ae=new WeakMap,mt=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),wt=function(){function e(t,r){this.callback=t,this.observer=r}return e}();function Ot(e){return Ae.get(e)}function At(e,t){return e.observers.get(t)}function Et(e,t){e.observers.delete(t.callback)}function _t(e,t){t.unobserve()}function bt(e,t){var r=[],n,o=Ot(e);if(!o)o=new mt(e),Ae.set(e,o);else{var a=At(o,t);n=a&&a.observer}if(n)return n;if(n={},o.value=_(e),t){n.callback=t,n.next=null;var u=function(){Ee(n)},l=function(){clearTimeout(n.next),n.next=setTimeout(u)};typeof window<"u"&&(window.addEventListener("mouseup",l),window.addEventListener("keyup",l),window.addEventListener("mousedown",l),window.addEventListener("keydown",l),window.addEventListener("change",l))}return n.patches=r,n.object=e,n.unobserve=function(){Ee(n),clearTimeout(n.next),Et(o,n),typeof window<"u"&&(window.removeEventListener("mouseup",l),window.removeEventListener("keyup",l),window.removeEventListener("mousedown",l),window.removeEventListener("keydown",l),window.removeEventListener("change",l))},o.observers.set(t,new wt(t,n)),n}function Ee(e,t){t===void 0&&(t=!1);var r=Ae.get(e.object);_e(r.value,e.object,e.patches,"",t),e.patches.length&&V(r.value,e.patches);var n=e.patches;return n.length>0&&(e.patches=[],e.callback&&e.callback(n)),n}function _e(e,t,r,n,o){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var a=me(t),u=me(e),l=!1,f=u.length-1;f>=0;f--){var c=u[f],i=e[c];if(ge(t,c)&&!(t[c]===void 0&&i!==void 0&&Array.isArray(t)===!1)){var s=t[c];typeof i=="object"&&i!=null&&typeof s=="object"&&s!=null&&Array.isArray(i)===Array.isArray(s)?_e(i,s,r,n+"/"+M(c),o):i!==s&&(o&&r.push({op:"test",path:n+"/"+M(c),value:_(i)}),r.push({op:"replace",path:n+"/"+M(c),value:_(s)}))}else Array.isArray(e)===Array.isArray(t)?(o&&r.push({op:"test",path:n+"/"+M(c),value:_(i)}),r.push({op:"remove",path:n+"/"+M(c)}),l=!0):(o&&r.push({op:"test",path:n,value:e}),r.push({op:"replace",path:n,value:t}))}if(!(!l&&a.length==u.length))for(var f=0;f<a.length;f++){var c=a[f];!ge(e,c)&&t[c]!==void 0&&r.push({op:"add",path:n+"/"+M(c),value:_(t[c])})}}}function Be(e,t,r){r===void 0&&(r=!1);var n=[];return _e(e,t,n,"",r),n}Object.assign({},gt,Object.freeze(Object.defineProperty({__proto__:null,compare:Be,generate:Ee,observe:bt,unobserve:_t},Symbol.toStringTag,{value:"Module"})),{JsonPatchError:Ke,deepClone:_,escapePathComponent:M,unescapePathComponent:Je});var J=(e=>(e.TRAVERSAL_START="Traversal_Start",e.TRAVERSAL_END="Traversal_End",e))(J||{});function te(e,t){const r=e.state;if(r.type==="checkpoint")return r.val;const{checkpointRef:n}=r,o=t[n],a=$e(o,e,t);a.shift();const u=a.map(c=>t[c]).map(c=>c.state.val).reduce((c,i)=>[...c,...i],[]),l=te(o,t);return V(l,_(u),!0,!1).newDocument}function Pt(e,t){const r=Object.keys(e).length;return new Set(t.map(o=>o.path.split("/")[0])).size<r/2?"patch":"checkpoint"}function Tt({registry:e,initialState:t}){let r=!1;const n=Te(),o=xe(t);function a(i){return o.backend.nodes[i]}n.listen(J.TRAVERSAL_START,()=>{r=!0}),n.listen(J.TRAVERSAL_END,()=>{r=!1});const u={add(i,s=o.current.id){o.update(o.addMetadata({id:s,meta:i}))},latestOfType(i,s=o.current.id){return o.backend.nodes[s].meta[i]?.at(-1)},allOfType(i,s=o.current.id){return o.backend.nodes[s].meta[i]},latest(i=o.current.id){const s=o.backend.nodes[i].meta,h=Object.keys(s).reduce((d,p)=>{const v=s[p].at(-1);return v&&(d[p]=v),d},{});return Object.keys(h).length>0?h:void 0},all(i=o.current.id){return o.backend.nodes[i].meta},types(i=o.current.id){return Object.keys(o.backend.nodes[i].meta)}},l={add(i,s=o.current.id){o.update(o.addArtifact({id:s,artifact:i}))},latest(i=o.current.id){return o.backend.nodes[i].artifacts.at(-1)},all(i=o.current.id){return o.backend.nodes[i].artifacts}},f={add(i,s=o.current.id){u.add({annotation:i},s)},latest(i=o.current.id){return u.latestOfType("annotation",i)?.val},all(i=o.current.id){return u.allOfType("annotation",i)?.map(s=>s.val)}},c={add(i=o.current.id){u.add({bookmark:!0},i)},remove(i=o.current.id){u.add({bookmark:!1},i)},is(i=o.current.id){return Boolean(u.latestOfType("bookmark",i)?.val)},toggle(i=o.current.id){c.is(i)?c.remove(i):c.add(i)}};return{registry:e,get isTraversing(){return r},getState(i=o.current){return te(i,o.backend.nodes)},graph:o,get current(){return o.current},get root(){return o.root},record({label:i,state:s,sideEffects:h,eventType:d,onlySideEffects:p=!1}){let v=null,m=null;const E=te(this.current,this.graph.backend.nodes);if(p)m={type:"checkpoint",val:s};else{const A=Be(E,s);if(Pt(s,A)==="checkpoint")m={type:"checkpoint",val:s};else{const Pe=this.current.state.type==="checkpoint"?this.current.id:this.current.state.checkpointRef;m={type:"patch",val:A,checkpointRef:Pe}}}if(!m)throw new Error(`Could not calculate new state. Previous state is: ${JSON.stringify(this.current.state,null,2)}`);if(v=Re({label:i,state:m,parent:this.current,sideEffects:h,event:d}),!v)throw new Error("State Node creation failed!");o.update(o.addNode(v))},async apply(i,s){const h=e.get(s.type),d=te(this.current,this.graph.backend.nodes);if(h.config.hasSideEffects){const{do:p=s,undo:v}=h.func(s.payload);this.record({label:i,state:d,sideEffects:{do:[p],undo:[v]},eventType:h.config.eventType})}else{const p=h.func(d,s.payload);this.record({label:i,state:p,sideEffects:{do:[],undo:[]},eventType:h.config.eventType})}},async to(i){n.fire(J.TRAVERSAL_START);const s=$e(o.current,o.backend.nodes[i],o.backend.nodes),h=[];for(let d=0;d<s.length-1;++d){const p=a(s[d]),v=a(s[d+1]);St(p,v)?T(p)&&h.push(...p.sideEffects.undo):T(v)&&h.push(...v.sideEffects.do)}for(const d of h){const p=e.get(d.type).func;await p(d.payload)}o.update(o.changeCurrent(i)),n.fire(J.TRAVERSAL_END)},undo(){const{current:i}=o;return T(i)?this.to(i.parent):Promise.resolve(console.warn("Already at root!"))},redo(i="latest"){const{current:s}=o;return s.children.length>0?this.to(s.children[i==="oldest"?0:s.children.length-1]):Promise.resolve(console.warn("Already at latest in this branch!"))},currentChange(i,s=!1){return o.currentChange(i,{skipOnNew:s})},done(){console.log("Setup later for URL sharing.")},tree(){return We(o.root,o.backend.nodes)},on(i,s){n.listen(i,s)},export(){return JSON.stringify(o.backend)},exportObject(){return JSON.parse(JSON.stringify(o.backend))},import(i){const s=JSON.parse(i),h=s.current;s.current=s.root,o.update(o.load(s)),this.to(h)},importObject(i){const s=i.current;i.current=i.root,o.update(o.load(i)),this.to(s)},metadata:u,artifact:l,annotations:f,bookmarks:c}}function Nt(e,t,r){let[n,o]=[e,t];n.level>o.level&&([n,o]=[o,n]);let a=o.level-n.level;for(;T(o)&&a!==0;)o=r[o.parent],a-=1;if(n.id===o.id)return n.id;for(;n.id!==o.id;)T(n)&&(n=r[n.parent]),T(o)&&(o=r[o.parent]);return n.id}function $e(e,t,r){const n=Nt(e,t,r),o=r[n],a=[],u=[];let[l,f]=[e,t];for(;l.id!==o.id;)a.push(l),T(l)&&(l=r[l.parent]);for(a.push(l);f.id!==o.id;)u.push(f),T(f)&&(f=r[f.parent]);const c=u.reverse();return[...a,...c].map(i=>i.id)}function St(e,t){if(T(e)&&e.parent===t.id)return!0;if(T(t)&&t.parent===e.id)return!1;throw new Error("Incorrect use of function. Nodes are not connected to each other.")}function We(e,t){return{...e,children:e.children.map(r=>We(t[r],t)),name:`${e.label}`}}nt();function Dt(e){return e.length===2?ft(e):e}class be{static create(){return new be}constructor(){this.registry=new Map}has(t){return this.registry.has(t)}register(t,r,n){const o=r.length===2;if(r.length>2)throw new Error("Incorrect action function signature. Action function can only have two arguments at most!");if(this.has(t))throw new Error(`Already registered: ${t}`);const{label:a=t,eventType:u=t}=n||{};return this.registry.set(t,{func:Dt(r),config:{hasSideEffects:!o,label:typeof a=="string"?()=>a:a,eventType:u}}),N.createAction(t)}get(t){const r=this.registry.get(t);if(!r)throw new Error(`Not registered: ${t}`);return r}}Object.defineProperty(w,"createAction",{enumerable:!0,get:()=>N.createAction}),w.ID=S,w.Registry=be,w.TrrackEvents=J,w.createRootNode=De,w.createStateNode=Re,w.initEventManager=Te,w.initializeProvenanceGraph=xe,w.initializeTrrack=Tt,w.isRootNode=Xe,w.isStateNode=T,Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.js.map
